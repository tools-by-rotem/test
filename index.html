<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>בודק נגישות</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
            direction: rtl; /* לשים את הדף מימין לשמאל */
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .loading {
            display: none;
            margin: 10px auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007BFF;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        ul {
            text-align: left;
            padding: 0;
            list-style-type: none;
        }
        li {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .score {
            font-size: 1.5em;
            margin-top: 20px;
            font-weight: bold;
        }
        .score.good {
            color: #28a745;
        }
        .score.bad {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>בודק נגישות</h1>
        <input type="text" id="url" placeholder="הזן כתובת URL לבדיקה">
        <button onclick="fetchAndCheckPage()">בדוק נגישות</button>
        <div class="loading" id="loading"></div>
        <ul id="report"></ul>
        <div id="score" class="score"></div>
        <button id="downloadButton" style="display:none;" onclick="downloadPDF()">הורד כ-PDF</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        async function fetchAndCheckPage() {
            const url = document.getElementById("url").value;
            const report = document.getElementById("report");
            const loading = document.getElementById("loading");
            const scoreElement = document.getElementById("score");
            const downloadButton = document.getElementById("downloadButton");

            if (!url) {
                alert("אנא הזן כתובת URL");
                return;
            }

            report.innerHTML = "";
            scoreElement.innerHTML = "";
            loading.style.display = "block";
            downloadButton.style.display = "none";

            try {
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                if (!response.ok) throw new Error("שגיאה בטעינת העמוד");
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, "text/html");
                runAccessibilityCheck(doc);
            } catch (error) {
                report.innerHTML = `<li class="error">❌ לא ניתן לטעון את הדף</li>`;
            } finally {
                loading.style.display = "none";
            }
        }

        function runAccessibilityCheck(doc) {
            const report = document.getElementById("report");
            const scoreElement = document.getElementById("score");
            let score = 100;

            // בדיקת כותרת ראשית
            if (!doc.querySelector("h1")) {
                report.innerHTML += "<li class='error'>❌ אין כותרת ראשית (H1)</li><small>הוסף כותרת ראשית לכל עמוד.</small>";
                score -= 10;
            } else {
                report.innerHTML += "<li class='success'>✅ כותרת ראשית קיימת</li>";
            }

            // בדיקת ALT לתמונות
            const images = doc.querySelectorAll("img");
            let missingAlt = [...images].filter(img => !img.alt).length;
            if (missingAlt > 0) {
                report.innerHTML += `<li class='error'>❌ ${missingAlt} תמונות ללא ALT</li><small>הוסף תיאורי ALT לכל התמונה עבור נגישות.</small>`;
                score -= 10;
            } else {
                report.innerHTML += "<li class='success'>✅ כל התמונות מכילות ALT</li>";
            }

            // בדיקת קישורים ללא טקסט
            const links = doc.querySelectorAll("a");
            let emptyLinks = [...links].filter(link => !link.textContent.trim()).length;
            if (emptyLinks > 0) {
                report.innerHTML += `<li class='error'>❌ ${emptyLinks} קישורים ללא טקסט</li><small>הוסף טקסט ברור לכל קישור.</small>`;
                score -= 10;
            } else {
                report.innerHTML += "<li class='success'>✅ כל הקישורים מכילים טקסט</li>";
            }

            // בדיקת כותרות היררכיות
            const headings = ["h1", "h2", "h3", "h4", "h5", "h6"];
            let missingHeadings = headings.every(tag => !doc.querySelector(tag));
            if (missingHeadings) {
                report.innerHTML += "<li class='error'>❌ אין כותרות היררכיות</li><small>הוסף כותרות היררכיות (H1-H6) על מנת לשמור על היררכיית מידע ברורה.</small>";
                score -= 10;
            } else {
                report.innerHTML += "<li class='success'>✅ יש כותרות היררכיות</li>";
            }

            // בדיקת רכיבי טופס עם תוויות
            const inputs = doc.querySelectorAll("input, textarea, select");
            let missingLabels = [...inputs].filter(input => !input.labels || input.labels.length === 0).length;
            if (missingLabels > 0) {
                report.innerHTML += `<li class='error'>❌ ${missingLabels} שדות טופס ללא תוויות</li><small>הוסף תוויות לכל שדות הטופס.</small>`;
                score -= 10;
            } else {
                report.innerHTML += "<li class='success'>✅ כל שדות הטופס מכילים תוויות</li>";
            }

            // הצגת ציון סופי עם צבע
            const scoreClass = score >= 80 ? 'good' : 'bad';
            scoreElement.innerHTML = `<strong>ציון נגישות כולל: ${score}/100</strong>`;
            scoreElement.classList.add(scoreClass);

            // הצגת כפתור להורדת PDF
            document.getElementById("downloadButton").style.display = "inline-block";
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(document.getElementById("report").innerText, 10, 10);
            doc.save("accessibility-report.pdf");
        }
    </script>
</body>
</html>
