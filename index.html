<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בודק נגישות</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .loading {
            display: none;
            margin: 10px auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007BFF;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        ul {
            text-align: right;
            padding: 0;
        }
        li {
            list-style: none;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .pass {
            background-color: #28a745;
            color: white;
            font-weight: bold;
        }
        .fail {
            background-color: #dc3545;
            color: white;
            font-weight: bold;
        }
        .info {
            background-color: #ffc107;
            color: black;
            font-weight: bold;
        }
        .score {
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        .score-green {
            background-color: #28a745;
            color: white;
        }
        .score-yellow {
            background-color: #ffc107;
            color: black;
        }
        .score-red {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>בודק נגישות</h1>
        <input type="text" id="url" placeholder="הזן כתובת URL לבדיקה">
        <button onclick="fetchAndCheckPage()">בדוק נגישות</button>
        <div class="loading" id="loading"></div>
        <ul id="report"></ul>
        <div id="score" class="score"></div>
        <button id="downloadBtn" style="display:none;">הורד דו"ח כ-PDF</button>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        async function fetchAndCheckPage() {
            const url = document.getElementById("url").value;
            const report = document.getElementById("report");
            const loading = document.getElementById("loading");
            const downloadBtn = document.getElementById("downloadBtn");
            const scoreDiv = document.getElementById("score");

            if (!url) {
                alert("אנא הזן כתובת URL");
                return;
            }

            report.innerHTML = "";
            scoreDiv.innerHTML = "";
            loading.style.display = "block";
            downloadBtn.style.display = "none";

            try {
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                const response = await fetch(proxyUrl + encodeURIComponent(url));
                if (!response.ok) throw new Error("שגיאה בטעינת העמוד");
                const data = await response.json();
                const text = data.contents;
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, "text/html");
                runAccessibilityCheck(doc);
                downloadBtn.style.display = "inline-block";
            } catch (error) {
                report.innerHTML = `<li class="fail">❌ לא ניתן לטעון את הדף</li>`;
            } finally {
                loading.style.display = "none";
            }
        }

        function runAccessibilityCheck(doc) {
            const report = document.getElementById("report");
            let score = 100;

            // בדיקת כותרת ראשית
            if (!doc.querySelector("h1")) {
                report.innerHTML += "<li class='fail'>❌ אין כותרת ראשית (H1) - חשוב שיהיה לכל עמוד כותרת ראשית</li>";
                score -= 10;
            } else {
                report.innerHTML += "<li class='pass'>✅ כותרת ראשית קיימת</li>";
            }

            // בדיקת ALT לתמונות
            const images = doc.querySelectorAll("img");
            let missingAlt = [...images].filter(img => !img.alt).length;
            if (missingAlt > 0) {
                report.innerHTML += `<li class='fail'>❌ ${missingAlt} תמונות ללא ALT - יש להוסיף תיאורים (alt) לתמונות</li>`;
                score -= 10;
            } else {
                report.innerHTML += "<li class='pass'>✅ כל התמונות מכילות ALT</li>";
            }

            // בדיקת צבעים עם ניגודיות
            const body = doc.querySelector("body");
            const computedStyle = getComputedStyle(body);
            const backgroundColor = computedStyle.backgroundColor;
            const textColor = computedStyle.color;
            const contrast = getContrast(backgroundColor, textColor);
            if (contrast < 4.5) {
                report.innerHTML += "<li class='fail'>❌ ניגודיות צבעים לא מספקת - יש לוודא שהצבעים מספיק מנוגדים לקריאות</li>";
                score -= 10;
            } else {
                report.innerHTML += "<li class='pass'>✅ ניגודיות צבעים טובה</li>";
            }

            // בדיקת קישורים ללא טקסט
            const links = doc.querySelectorAll("a");
            let emptyLinks = [...links].filter(link => !link.textContent.trim()).length;
            if (emptyLinks > 0) {
                report.innerHTML += `<li class='fail'>❌ ${emptyLinks} קישורים ללא טקסט - יש להוסיף טקסט לכל קישור</li>`;
                score -= 10;
            } else {
                report.innerHTML += "<li class='pass'>✅ כל הקישורים מכילים טקסט</li>";
            }

            // הצגת ציון סופי
            if (score >= 90) {
                scoreDiv.innerHTML = `<strong class="score-green">ציון נגישות: ${score}/100 - מצוין!</strong>`;
            } else if (score >= 50) {
                scoreDiv.innerHTML = `<strong class="score-yellow">ציון נגישות: ${score}/100 - יש לשפר</strong>`;
            } else {
                scoreDiv.innerHTML = `<strong class="score-red">ציון נגישות: ${score}/100 - לא נגיש</strong>`;
            }
        }

        document.getElementById("downloadBtn").addEventListener("click", function() {
            const doc = new jsPDF();
            const content = document.getElementById("report").innerText;
            doc.text(content, 10, 10);
            doc.save("accessibility-report.pdf");
        });

        // פונקציה לחישוב ניגודיות צבעים
        function getContrast(rgb1, rgb2) {
            const rgb1Array = rgb1.match(/\d+/g).map(Number);
            const rgb2Array = rgb2.match(/\d+/g).map(Number);
            const luminance1 = 0.2126 * Math.pow(rgb1Array[0] / 255, 2.2) + 0.7152 * Math.pow(rgb1Array[1] / 255, 2.2) + 0.0722 * Math.pow(rgb1Array[2] / 255, 2.2);
            const luminance2 = 0.2126 * Math.pow(rgb2Array[0] / 255, 2.2) + 0.7152 * Math.pow(rgb2Array[1] / 255, 2.2) + 0.0722 * Math.pow(rgb2Array[2] / 255, 2.2);
            return (Math.max(luminance1, luminance2) + 0.05) / (Math.min(luminance1, luminance2) + 0.05);
        }
    </script>
</body>
</html>
